/* https://keycode.info/ */

/* Make a Stats page so you can see progress in an actual chart - maybe look into java packages for displaying graphs */
/* Maybe make developer mode too so you can type at infinite speed at 1 word/exercise and not make the charts look weird */

/*
You just have to think of all the keys as different.
Increasing order of farness: 4, 8, 5, 7, 6.
9 & 0 are right above
` is way far back
1 is far back
2, 3 are back

 */

// localStorage.removeItem('progress');

/*  --------- TEXT GENERATION ---------  */
/* doesn't do anything now, but when there was less code and the page loaded slower, this set a delay so that command-R
didn't also press the first key. */
window.onload = function() {
    const interactive_container = document.getElementsByClassName('interactive-container')[0];
    let unedited_string = '';

    /* PICK METHOD OF TEXT GENERATION */
    const method_of_generating_text = 2;  // Number 1 or 2 refers to which method to use
    const exercise_length = 20; // 20     // Length of words you are going to type

    // METHOD 1: Create a sentence based on randomly strung together chars_to_evenly_distribute.
    const chars_to_evenly_distribute = [';', ':', '?', 1, '!', 2, '@', 3, '#', 9, '(', 0, ')', '-', '_', '=', '+', 4, '$', 8, '*', '[', '{', ']', '}', 5, '%', 7, '&', 6, '^', '`', '\'', '\"', '~', '\\', 'a', 'e', 'i', 'o', 'u', 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0];   // words will be made up of a combination of these characters and nothing else.
    const word_length = [5, 10];

    /* *METHOD 2: Take an excerpt of a book and put special chars in existing words in existing sentence structure.
    This has the advantage that you're not missing practicing certain letters. */
    const special_chars = ['<p>', '</p>', '<span>', '</span>', ';', ':', '?', 1, '!', 2, '@', 3, '#', 9, '(', 0, ')', '-', '_', '=', '+', 4, '$', 8, '*', '[', '{', ']', '}', 5, '%', 7, '&', 6, '^', '`', '~', '\\', '[\'', '\']', '(\'', '\')'];
    // let special_chars = [1, 2, 3, 9, 0, 1, '!', '/', '`', '~', '\\', ']', '}'];
    const special_char_length = [2, 5]; // 2 -5
    const sentences = ["Flannery O'Connor's first book has never, up to now, been published","It was entitled The Geranium: A Collection of Short Stories and consists of the first six stories in this volume","The title page of the original manuscript, in the library of the University of Iowa, bears the legend, \"A thesis submitted in partial fulfillment of the requirements for the degree of Master of Fine Arts, in the Department of English, in the Graduate College of the State University of Iowa.\" It is dated June 1947 and a separate page carries a dedication to her teacher, Paul Engle","At their first meeting in his office, in 1946, Mr","Engle recalls, he was unable to understand a word of Flannery's native Georgian tongue: \"Embarrassed, I asked her to write down what she had just said on a pad","She wrote: 'My name is Flannery O'Connor","I am not a journalist","Can I come to the Writer's Workshop?' I told her to bring examples of her writing and we would consider her, late as it was","Like Keats, who spoke Cockney but wrote the purest sounds in English, Flannery spoke a dialect beyond instant comprehension but on the page her prose was imaginative, tough, alive: just like Flannery herself","For a few weeks we had this strange and yet trusting relationship","Soon I understood those Georgia pronunciations","The stories were quietly filled with insight, shrewd about human weakness, hard and compassionate She was shy about having them read, and when it was her turn to have a story presented in the Workshop, I would read it aloud anonymously","Robert Penn Warren was teaching a semester while Flannery was at the University of Iowa; there was a scene about a black and a white man, and Warren criticized it It was changed","Flannery always had a flexible and objective view of her own writing, constantly revising, and in every case improving","The will to be a writer was adamant; nothing could resist it, not even her own sensibility about her own work","Cut, alter, try it again Sitting at the back of the room, silent, Flannery was more of a presence than the exuberant talkers who serenade every writing-class with their loudness","The only communicating gesture she would make was an occasional amused and shy smile at something absurd","The dreary chair she sat in glowed.\" The publishing career of this unknown writer of twenty-one had already started","Flannery mailed \"The Geranium\" to the editors of Accent as early as February 1946","They accepted it at once and printed it in their summer issue","On the basis of the stories she later incorporated into her novel-in-progress, Wise Blood, Mr","Engle recommended her for a prize offered by a publisher for a first novel","In the spring of 1947 she was awarded this prize - the sum of $750, which was to serve as part of the advance against royalties if the publisher ultimately accepted the novel","Flannery received her master's degree that summer; Sewanee Review published \"The Train\" the next spring; in June 1948 she took the important and crucial step of finding a literary agent and a lifelong friend, Elizabeth McKee","Miss McKee placed her story \"The Capture\" (entitled \"The Turkey\" in the thesis) wi th Mademoiselle in November","It was shortly after this - I was not the publisher involved with the prize - that I met Flannery O'Connor","Robert Lowell brought her into my office late in February 1949","They had come to New York from Yaddo, the writer's colony at Saratoga Springs, where Flannery worked on Wise Blood and Lowell on his poems","Behind her soft-spoken speech, clear-eyed gaze and shy manner, I sensed a tremendous strength","This was the rarest kind of young writer, one who was prepared to work her utmost and knew exactly what she must do with her talent","I rather regretted, as a publisher, meeting such an interesting writer at the start of a career in which I could play no part","She told me she was committed elsewhere, and if I knew anything it was that she would honor her commitment","She asked about a new writer I had recently published - Thomas Merton; I gave her a copy of The Seven Storey Mountain to take with her to her mother's house in Milledgeville, Georgia","Later I heard that she would be coming north again to live in Connecticut with my friends Sally and Robert Fitzgerald and I hoped I'd have the opportunity to know her better","It was not until after her death in 1964 that I learned exactly how her publishing fate took an unexpected turn","(Our later publishing relationship also developed surprisingly, and I'll come to that.) The details are fully and rather comically recorded in her correspondence with Elizabeth McKee, who gave me copies of the letters before she added the originals to the papers that Flannery's mother, Regina O'Connor, is collecting","The excerpts from Flannery's letters are quoted here with the permission of her literary executor, Robert Fitzgerald","In her first letter (June 19, 1948) to Miss McKee, Flannery revealed she had been working on the novel \"a year and a half and will probably be two more years finishing it.\" She described her writing habits in a letter dated July 13: \"I must tell you how I work","I don't have my novel outlined and I have to write to discover what I am doing","Like the old lady, I don't know so well what I think until I see what I say; then I have to say it over again","I am working on the twelfth chapter now","I long ago quit numbering the pages but I suppose I am past the 50,000 word mark","Of the twelve chapters only a few won't have to be rewritten, and I can't exhibit such formless stuff","It would discourage me to look at it right now and anyway I yearn to go about my business to the end.\" At the end of the year, when she was worried about money, her agent advised her to submit the new chapters in order to get a definite commitment and perhaps a further advance","FromYaddo, December 15, 1948: \"Perhaps I shall get down [to New York] in January and perhaps before that send you the chapters I am working on I have decided, however, that no good comes of sending anything off in a hurry.\" On January 20, 1949, Flannery wrote: \"Here are the first nine chapters which please show [the publisher] and let us be on with financial thoughts","They are, of course, not finished but they are finished enough for the present.\" When there was no response by February 5: \"I'll be anxious to hear the outcome.\" She heard it on February 16 and it was not to her liking","One can sympathize with the publisher's problem at this early stage of composition","Wise Blood was a strange book, as Flannery would have been the first to acknowledge","What she could not accept was the tone of the publisher's letter","He said he thought she was a pretty straight shooter, that she had an astonishing gift, but that some aspects of the book were obscured by her habit of rewriting over and over again","To be honest, he added, he sensed a kind of aloneness in the book, as if she were writing out of her own experience, and consciously limiting this experience","He wished she would sit down and tell him what was what","He hoped she didn't mind his forthright letter","Flannery wrote at once to Miss McKee: \"Please tell me what is behind this Sears-Roebuck Straight Shooter approach","I presume either that [the publisher] will not take the novel as it will be if left to my fiendish care (it will be essentially as it is), or that [the publisher] would like to rescue it at this point and train it into a conventional novel The letter is addressed to a slightly dimwitted Campfire Girl, and I cannot look forward with composure to a lifetime of others like them.\" At the same time, in an effort to honor her commitment, she answered the publisher's letter next day: \"I can only hope that in the finished novel the direction will be clearer I feel that whatever virtues the novel may have are very much connected with the limitations you mention","I am not writing a conventional novel, and I think that the quality of the novel I write will derive precisely from the peculiarity or aloneness, if you will, of the experience I write from In short, I am amenable to criticism but only within the sphere of what I am trying to do; I will not pretend to do otherwise","The finished book, though I hope less angular, will be just as odd if not odder than the nine chapters you now have.\" Matters had not improved much by the following April, when she wrote Paul Engle to tell himthat \"other publishers who have read the two printed chapters\" - she was referring to \"The Train\" and to the publication that winter of \"The Heart of the Park\" in Partisan Review - \"are interested.\" She also told him about her meeting with the dissatisfied publisher, at which he \"and I came to the conclusion that I was 'prematurely arrogant.' I supplied him with the phrase.\" She thought that \"no one will understand my need to work this novel out in my own way better than you, although you may feel that I should work faster","I work ALL the time, but I cannot work fast","No one can convince me I shouldn't rewrite as much as I do.\" She concluded with the news that she had been turned down for the Guggenheim fellowship for which Mr","Engle had recommended her","(Her other sponsors were Robert Lowell, Philip Rahv and Robert Penn Warren.) I met her again in May 1950, at the christening of Maria Juliana Fitzgerald in Ridgefield, Connecticut","I noted what good spirits Flannery was in, as we gravely performed our roles as godparents, renouncing the devil and all his works and pomps","(It is to be regretted that she did not live to see our godchild become Sister Mary Julian in 1970.) She told me she was still working hard on the novel and was still committed to her publisher, though her literary agent soon informed me that the submission of additional chapters had not allayed his doubts","Finally, in October, after she had obtained a release from him, I offered and she signed a contract for Wise Blood","The strength I sensed in Flannery at our first meeting now had an incredible strain put on it","She was stricken with lupus on her journey home for Christmas, and spent nine months, desperately ill, in and out of Emory Hospital inAtlanta","On her release she was unable to climb stairs, and Regina O'Connor then decided to move to \"Andalusia,\" their country place five miles from town, which was to be their home and Flannery's refuge from then on","By the following September Flannery was writing Miss McKee, \"The last time I saw Bob Giroux, he said we would push the date [of delivery of the manuscript] up to the first of the year [1951] but that there was nothing magic in that date","There is nothing magic in my speed or progress at this time, but I don't know anything for it","I plan to last until the first of the year and then see what I've got.\" A full year later (September 1, 1951) she wrote Miss McKee from Milledgeville: \"Bob Giroux and Caroline Gordon made some suggestions for improving my book and I have been working on these and have by now about come up with another draft of it.\" By the end of the year the novel was ready, and we began to prepare for publication","Flannery had less vanity than anyone I have ever known","When I asked her for a photograph to use on the book jacket, I expected a picture taken before her illness","The new one she sent was not unattractive, and she looked out at the reader with that clear-eyed gaze of hers, but her hair had not fully grown back nor had the puffiness induced by cortisone wholly subsided","The photograph was widely reproduced when Wise Blood was published in May 1952","I was disappointed by the reviews more than she was; they all recognized her power but missed her point","In the five years between 1947, when a draft of the first chapter of Wise Blood was written, and 1952, Flannery's development was amazing","In the three years following, she wrote better and better","Starting late in 1952 with \"A Good Man Is Hard to Find,\" a masterpiece of a story, she turned out one beauty after another, including \"The River,\" \"The Life You Save May Be Your Own,\" \"The Displaced Person,\" \"The Artificial Nigger\" and \"Good Country People.\" Catherine Carver, whom we were fortunate enough to have as an editor, and who worked with Flannery at this period, brought each new story into my office with more or less the same remark, \"Wait till you read this one!\" Early in 1955 Flannery completed work on her second book, a collection of these stories which she entitled A Good Man Is Hard to Find","In January we sent it to press, having set publication for June","I remember our amusement at Evelyn Waugh's reaction to the advance proofs we sent him: \"If these stories are in fact the work of a young lady, they are indeed remarkable.\" At the beginning of April, before the book appeared, I resigned from the firm and joined the house with which I have since been associated","When Flannery sent me an inscribed copy, soon after my departure, I felt a twinge of sadness that my editorial association with her books had ended","Once again fate rearranged what seemed to be an unalterable course","After the very successful publication of A Good Man Is Hard to Find, Flannery was offered a new contract about which she asked my advice, saying she wanted to stay as long as Catherine Carver remained as her editor","In that case, I suggested, why not ask that such a stipulation be incorporated in the contract? This was not readily granted, but Flannery had made up her mind and in the end she got what she wanted","Within three years, after Catherine Carver and Denver Lindley had left, it came to pass that Flannery was free to join the house she remained with until her death","We contracted for her third book, \"a novel in progress,\" on April 15, 1958, and published The Violent Bear It Away in 1960","Then I learned that Wise Blood was out of print, and we soon acquired this classic work","She wrote a short and eloquent preface for the second edition, describing the book as \"a comic novel about a Christian malgre lui\" and stating that it had been written by \"an author congenitally innocent of theory, but one with certain preoccupations","That belief in Christ is to some a matter of life and death has been a stumbling block for readers who would prefer to think it a matter of no great consequence.\" She ended by defining her theme, free will or freedom, as \"a mystery, and one which a novel, even a comic novel, can only be asked to deepen.\" We reissued Wise Blood in 1962, on the tenth anniversary of the original publication, and it lives on both in cloth and paperback editions","Didn't some wise man define a classic as a book that does not stay out of print? One of Flannery's admirers was Thomas Merton, who became more of a fan with each new book of hers","Over the years I came to see how much the two had in common - a highly developed sense of comedy, deep faith, great intelligence","The aura of aloneness surrounding each of them was not an accident","It was their metier, in which they refined and deepened their very different talents in a short span of time","They both died at the height of their powers","Finally, they were both as American as one can be","When publication of Merton's The Sign of Jonas was forbidden by the Abbot General in France, I was able to obtain its release only with the help of Jacques Maritain, who wrote himin beautiful French (the Abbot General did not read English and consequently had not read The Sign of Jonas), explaining what the \"American Trappist\" was up to","As for Flannery, whose work can only be understood in an American setting, when a German publisher wanted to drop some of her stories as too shocking for Germanic sensibilities, she wrote Miss McKee, \"I didn't think I was that vicious.\" On a trip south in 1959 I stopped at the Abbey of Gethsemani in Kentucky to see Merton, before going to see Flannery in Georgia","He gave me a presentation copy of the beautifully designed private edition of Prometheus: A Meditation to take to her","He was much interested in Flannery's peacocks","From previous visits to \"Andalusia\" I was able to tell him about their habits - how they roost at dusk by gradual hops from ground to fence post to tree limb; how their trains get caught under car wheels because they refuse to hurry; how vain they are (they seemed to jockey for good angles when they saw my camera); how funny it is to see peachicks rehearsing with their immature featherduster tails; and how rare it is to see the ultimate display, when the peacock shimmers and shakes his feathers in a kind of ecstasy at the height of preening","I could not tell Merton enough about them or about Flannery and her surroundings","What was Milledgeville like? Well, one of its sights was the beautiful ante-bellum Cline house, where Flannery's aunt served a formal midday dinner","He was surprised to learn that far from being \"backwoods\" Milledgeville had once been the capital of Georgia","I also showed him a letter in which Flannery wrote: \"Somebody sent me a gossip column that said Gene Kelly would make his TV debut in Flannery O'Connor's 'backwoods love story' [The Life You Save May Be Your Own]","I certainly can't afford to miss this metamorphosis.\" When I got to the O'Connors', Flannery was curious to hear about Gethsemani","Was Merton allowed to talk to me? Yes, without restriction","I described our walks in the woods and the monastic routine of the day: first office (Matins) at two a.m","and last office (Compline) at sunset, followed by bed","I mentioned that in Louisville I'd bought Edith Sitwell's recording of Facade, which Merton played over and over, laughing so hard that tears ran down his cheeks, and Flannery asked me to recite some of the poems","Even my pallid approximation of Dame Edith's renderings of \"Daisy and Lily, lazy and silly,\" \"Long Steel Grass\" (pronounced \"Grawss\"), \"Black Mrs","Behemoth\" and the rest made her face light up with smiles","When Flannery died, Merton was not exaggerating his estimate of her worth when he said he would not compare her with such good writers as Hemingway, Porter and Sartre but rather with \"someone like Sophocles I write her name with honor, for all the truth and all the craft with which she shows man's fall and his dishonor.\" Up to the very end, she worked hard","She was working on Everything That Rises Must Converge during her final illness","\"I have been thinking about this collection of my stories and what can be done to get it out with me sick,\" she wrote Miss McKee on May 7, 1964","\"I am definitely out of commission for the summer and maybe longer with this lupus","I have to stay mostly in bed If I were well there is a lot of rewriting and polishing I could do, but in my present state of health [the stories] are essentially all right the way they are.\" This is a typical O'Connor understatement; some of these last stories, like \"Revelation\" and the title story, are as nearly perfect as stories can be","In the same letter she proposed eight stories for the book, one of which, \"The Partridge Festival,\" she later withdrew","All eight had appeared in magazines","Later in May she wrote, \"I forgot to tell Bob Giroux that the title Everything That Rises Must Converge is all right with me if he thinks that is what it ought to be.\" It seemed absolutely right and (though she never said so) may have dated from a few years earlier when I sent her a French anthology of the writings of Teilhard de Chardin, one section of which was entitled Tout Ce Qui Monte Converge","I was unaware of the two unpublished stories she was working on","The first of these new stories was \"Parker's Back.\" Caroline Gordon later wrote of it: \"Miss O'Connor's stories are all about the operations of supernatural grace in the lives of natural men and women","Such operations are infinitely letious but so delicate that they have eluded some of the subtlest writers","In 'Parker's Back,' Miss O'Connor seems to have succeeded where the great Flaubert failed: in the dramatization of that particular heresy which denies Our Lord corporeal substance","We do not naturally like anything which is unfamiliar","No wonder Miss O'Connor's writings have baffled the reviewers, so much so they have reached for any cliche they could lay hold of in order to have some way of apprehending this original and disturbing work.\" The final story, \"Judgement Day,\" was mailed to me in early July","It is a revised and expanded version of \"The Geranium,\" which appears to have been a favorite of hers, for letters to Miss McKee reveal that in 1955 she had also worked on an intermediate version under the title \"An Exile in the East.\" As \"Judgement Day\" it became the ninth story in the collection published posthumously in 1965","What turned out to be my last letter to Flannery was dated July 7, 1964","I knew of the recurrence of her illness, of course, but I did not know that the lupus was now uncontrolled","I enclosed with my letter an advance proof of our catalogue description of Everything That Rises Must Converge as it was then conceived","She never replied and in late July she was taken to the Baldwin County hospital at Milledgeville, where she died in a coma on August 3","There are thirty-one stories in this volume","Nineteen are taken from Flannery's two collections and twelve appear for the first time in book form","For this edition we have followed the author's original manuscripts for \"The Partridge Festival,\" \"Why Do the Heathen Rage?\" and the first six stories","For the latter group we have also retained the order she followed in her thesis","The order of the other stories is chronological according to date of composition and does not duplicate the arrangement the author worked out for the two collections, which are of course available as she wanted them","Nor is it implied that all the stories here are of equal merit","It simply seems desirable to preserve as complete a collection of Flannery O'Connor's short fiction as possible","Elizabeth Bishop, who with her poet's eye sees more than most of us, wrote at the time of Flannery's death: \"I am sure her few books will live on and on in American literature","They are narrow, possibly, but they are clear, hard, vivid, and full of bits of description, phrases, and an odd insight that contains more real poetry than a dozen books of poems.\" She added a bit of testimony that Flannery herself would have relished: \"Critics who accuse her of exaggeration are quite wrong, I think","I lived in Florida for several years next to a flourishing 'Church of God' (both white and black congregation), where every Wednesday night Sister Mary and her husband 'spoke in tongues.' After those Wednesday nights, nothing Flannery O'Connor ever wrote could seemat all exaggerated to me.\" Robert Giroux The Geranium Old Dudley folded into the chair he was gradually molding to his own shape and looked out the window fifteen feet away into another window framed by blackened red brick","He was waiting for the geranium","They put it out every morning about ten and they took it in at five-thirty","Mrs","Carson back home had a geranium in her window","There were plenty of geraniums at home, better-looking geraniums","Ours are sho nuff geraniums, Old Dudley thought, not any er this pale pink business with green, paper bows","The geranium they would put in the window reminded him of the Grisby boy at home who had polio and had to be wheeled out every morning and left in the sun to blink","Lutisha could have taken that geranium and stuck it in the ground and had something worth looking at in a few weeks","Those people across the alley had no business with one","They set it out and let the hot sun bake it all day and they put it so near the ledge the wind could almost knock it over","They had no business with it, no business with it","It shouldn't have been there","Old Dudley felt his throat knotting up","Lutish could root anything","Rabie too","His throat was drawn taut","He laid his head back and tried to clear his mind","There wasn't much he could think of to think about that didn't do his throat that way","His daughter came in","\"Don't you want to go for a walk?\" she asked","She looked provoked","He didn't answer her","\"Well?\" \"No.\" He wondered how long she was going to stand there","She made his eyes feel like his throat","They'd get watery and she'd see","She had seen before and had looked sorry for him","She'd looked sorry for herself too; but she could er saved herself, Old Dudley thought, if she'd just have let him alone - let him stay where he was back home and not be so taken up with her damn duty","She moved out of the room, leaving an audible sigh, to crawl over him and remind him again of that one minute - that wasn't her fault at all - when suddenly he had wanted to go to New York to live with her","He could have got out of going","He could have been stubborn and told her he'd spend his life where he'd always spent it, send him or not send him the money every month, he'd get along with his pension and odd jobs","Keep her damn money  - she needed it worse than he did","She would have been glad to have had her duty disposed of like that","Then she could have said if he died without his children near him, it was his own fault; if he got sick and there wasn't anybody to take care of him, well, he'd asked for it, she could have said","But there was that thing inside him that had wanted to see New York","He had been to Atlanta once when he was a boy and he had seen New York in a picture show","Big Town Rhythm it was","Big towns were important places","The thing inside him had sneaked up on him for just one instant","The place like he'd seen in the picture show had room for him! It was an important place and it had room for him! He'd said yes, he'd go","He must have been sick when he said it","He couldn't have been well and said it","He had been sick and she had been so taken up with her damn duty, she had wangled it out of him","Why did she have to come down there in the first place to pester him? He had been doing all right","There was his pension that could feed him and odd jobs that kept him his room in the boarding house","The window in that room showed him the river - thick and red as it struggled over rocks and around curves","He tried to think how it was besides red and slow","He added green blotches for trees on either side of it and a brown spot for trash somewhere upstream","He and Rabie had fished it in a flat-bottom boat every Wednesday","Rabie knew the river up and down for twenty miles","There wasn't another boy in Coa County that knew it like he did","He loved the river, but it hadn't meant anything to Old Dudley","The fish were what he was after","He liked to come in at night with a long string of them and slap them down in the sink","\"Few fish I got,\" he'd say","It took a man to get those fish, the old girls at the boarding house always said","He and Rabie would start out early Wednesday morning and fish all day","Rabie would find the spots and row; Old Dudley always caught them","Rabie didn't care much about catching them - he just loved the river","\"Ain't no use settin' yo' line down dere, boss,\" he'd say","\"Ain't no fish dere","Dis ol' riber ain't hidin' none nowhere 'round hyar, nawsuh.\" And he would giggle and shift the boat downstream","That was Rabie","He could steal cleaner than a weasel but he knew where the fish were","Old Dudley always gave himthe little ones","Old Dudley had lived upstairs in the corner room of the boarding house ever since his wife died in '22","He protected the old ladies","He was the man in the house and he did the things a man in the house was supposed to do","It was a dull occupation at night when the old girls crabbed and crocheted in the parlor and the man in the house had to listen and judge the sparrow-like wars that rasped and twittered intermittently","But in the daytime there was Rabie","Rabie and Lutisha lived down in the basement","Lutish cooked and Rabie took care of the cleaning and the vegetable garden; but he was sharp at sneaking off with half his work done and going to help Old Dudley with some current project - building a hen house or painting a door","He liked to listen, he liked to hear about Atlanta when Old Dudley had been there and about how guns were put together on the inside and all the other things the old man knew","Sometimes at night they would go 'possum hunting","They never got a 'possum but Old Dudley liked to get away from the ladies once in a while and hunting was a good excuse","Rabie didn't like 'possum hunting","They never got a 'possum; they never even treed one; and besides, he was mostly a water boy","\"We ain't gonna go huntin' no 'possum tonight, is we, boss? I got a lil' business I wants tuh tend tuh,\" he'd say when Old Dudley would start talking about hounds and guns","\"Whose chickens you gonna steal tonight?\" Dudley would grin","\"I reckon I be huntin' 'possumtonight,\" Rabie'd sigh","Old Dudley would get out his gun and take it apart and, as Rabie cleaned the pieces, would explain the mechanism to him","Then he'd put it together again","Rabie always marveled at the way he could put it together again","Old Dudley would have liked to have explained New York to Rabie","If he could have showed it to Rabie, it wouldn't have been so big - he wouldn't have felt pressed down every time he went out in it","\"It ain't so big,\" he would have said","\"Don't let it get you down, Rabie","It's just like any other city and cities ain't all that complicated.\" But they were","New York was swishing and jamming one minute and dirty and dead the next","His daughter didn't even live in a house","She lived in a building - the middle in a row of buildings all alike, all blackened-red and gray with rasp- mouthed people hanging out their windows looking at other windows and other people just like them looking back","Inside you could go up and you could go down and there were just halls that reminded you of tape measures strung out with a door every inch","He remembered he'd been dazed by the building the first week","He'd wake up expecting the halls to have changed in the night and he'd look out the door and there they stretched like dog runs","The streets were the same way","He wondered where he'd be if he walked to the end of one of them","One night he dreamed he did and ended at the end of the building - nowhere","The next week he had become more conscious of the daughter and son-in-law and their boy - no place to be out of their way","The son-in-law was a queer one","He drove a truck and came in only on the weekends","He said \"nah\" for \"no\" and he'd never heard of a 'possum","Old Dudley slept in the room with the boy, who was sixteen and couldn't be talked to","But sometimes when the daughter and Old Dudley were alone in the apartment, she would sit down and talk to him","First she had to think of something to say","Usually it gave out before what she considered was the proper time to get up and do something else, so he would have to say something","He always tried to think of something he hadn't said before","She never listened the second time","She was seeing that her father spent his last years with his own family and not in a decayed boarding house full of old women whose heads jiggled","She was doing her duty","She had brothers and sisters who were not","Once she took him shopping with her but he was too slow","They went in a \"subway\" - a railroad underneath the ground like a big cave","People boiled out of trains and up steps and over into the streets","They rolled off the street and down steps and into trains - black and white and yellow all mixed up like vegetables in soup","Everything was boiling","The trains swished in from tunnels, up canals, and all of a sudden stopped","The people coming out pushed through the people coming in and a noise rang and the train swooped off again","Old Dudley and the daughter had to go in three different ones before they got where they were going","He wondered why people ever went out of their houses","He felt like his tongue had slipped down in his stomach","She held him by the coat sleeve and pulled him through the people","They went on an overhead train too","She called it an \"El.\" They had to go up on a high platform to catch it","Old Dudley looked over the rail and could see the people rushing and the automobiles rushing under him","He felt sick","He put one hand on the rail and sank down on the wooden floor of the platform","The daughter screamed and pulled him over from the edge","\"Do you want to fall off and kill yourself?\" she shouted","Through a crack in the boards he could see the cars swimming in the street","\"I don't care,\" he murmured, \"I don't care if I do or not.\" \"Come on,\" she said, \"you'll feel better when we get home.\" \"Home?\" he repeated","The cars moved in a rhythm below him","\"Come on,\" she said, \"here it comes; we've just got time to make it.\" They'd just had time to make all of them","They made that one","They came back to the building and the apartment","The apartment was too tight","There was no place to be where there wasn't somebody else","The kitchen opened into the bathroom and the bathroom opened into everything else and you were always where you started from","At home there was upstairs and the basement and the river and downtown in front of Fraziers damn his throat","The geranium was late today","It was ten-thirty","They usually had it out by ten fifteen","Somewhere down the hall a woman shrilled something unintelligible out to the street; a radio was bleating the worn music to a soap serial; and a garbage can crashed down a fire escape","The door to the next apartment slammed and a sharp footstep clipped down the hall","\"That would be the boy,\" Old Dudley muttered","\"The boy with the shiny shoes.\" He had been there a week when the boy moved in","That Thursday he was looking out the door at the dog-run halls when this boy went into the next apartment","He had on a gray, pin-stripe suit and a tan tie","His collar was stiff and white and made a clear-cut line next to his neck","His shoes were shiny tan - they matched his tie and his skin","Old Dudley scratched his head","He hadn't known the kind of people that would live thick in a building could afford servants","He chuckled","Lot of good a boy in a Sunday suit would do them","Maybe this boy would know the country around here - or maybe how to get to it","They might could hunt","They might could find them a stream somewhere"];
    let words_used = 0;

    if (method_of_generating_text === 1) {
        // For each word to be created
        for (let i = 0; i < exercise_length; i++) {

            // Create a word of random char length.
            let num_chars = Math.floor(Math.random() *(word_length[1] - word_length[0] + 1)) + word_length[0];
            for (let j = 0; j < num_chars; j++) {

                // Pick a random index from chars_to_evenly_distribute: 1-4 if it has 4 indices
                unedited_string += "" + chars_to_evenly_distribute[Math.floor(Math.random() * chars_to_evenly_distribute.length)];
            }
            unedited_string += ' ';
        }
    }
    else if (method_of_generating_text === 2) {
        // If you still need more characters,
        while (words_used < exercise_length) {

            // Extract another random sentence
            let excerpt_sentence = sentences[Math.floor(Math.random() * sentences.length)];
            let words = excerpt_sentence.split(' ');
            words[words.length -1] += '.'; // spaces are added between every word, so that works for ends of sentences too.
            console.log('from this sentence: ' + excerpt_sentence + '\nWe get: ' + words);
            let curr_word_in_sentence = 0;

            // Loop through the words in the excerpt_sentence and add them to 'sentence' w/ special characters at the end, one at a time.
            while (curr_word_in_sentence < words.length && words_used < exercise_length) {
                unedited_string += words[curr_word_in_sentence];
                let num_chars_at_end = Math.floor(Math.random() *(special_char_length[1] - special_char_length[0] + 1)) + special_char_length[0];
                for (let j = 0; j < num_chars_at_end; j++) {

                    // Pick a random index from chars_to_evenly_distribute: 1-4 if it has 4 indices
                    unedited_string += "" + special_chars[Math.floor(Math.random() * special_chars.length)];
                }

                // Add spaces between words + keeping tabs
                unedited_string += " ";
                curr_word_in_sentence ++;
                words_used ++;
            }
            curr_word_in_sentence = 0;
        }
    }
    else if (method_of_generating_text === 3) {
        // paste text below if you'd rather that
        interactive_container.innerHTML = '';
        // delete \n characters in pasted text, in case you decide to paste text in interactive_container instead
        for (let i = 0; i < interactive_container.innerHTML.length - 1; i++) {
            if(interactive_container.innerHTML.charAt(i) === '\n') {
                interactive_container.innerHTML = interactive_container.innerHTML.substring(0, i) + interactive_container.innerHTML.substring(i+1);
            }
        }
    }
    console.log(`So we span this:\n${unedited_string}`);

    /*  --------- ADDING WPM IF EXISTS ---------  */
    // (assuming 5 character words on average)
    if (localStorage.progress) {
        let progress_copy = JSON.parse(localStorage.progress);
        let last_rounded_wpm = progress_copy[progress_copy.length - 1];
        $(".stats").html(`typing speed: <span class='flash-animation'>${last_rounded_wpm}</span>`);
    }

    /*  --------- PARSING TEXT GENERATION ---------  */
    /* Go through elements in .interactive-container and put a span tag around each char of class na. Then when a key
    even comes in, go through the first .na and see if it matches, then put a .y or .n class. And then the delete button
    deletes the last .y or .n class. */
    let edited_string = "";
    for (let i = 0; i < unedited_string.length; i++) {
        edited_string += "<span>" + unedited_string.charAt(i) + "</span>";
    }
    document.getElementsByClassName('interactive-container')[0].innerHTML = edited_string;
    let char_els =  document.getElementsByClassName('interactive-container')[0].children;
    char_els[0].className = 'c';
    console.log(char_els);

    // If got_previous_char_correct is true but curr evaluates false, curr++.
    let curr_index = 0;
    let got_previous_char_correct = true;   // did they answer the last char correctly
    let first_press = true;
    let seconds_counter = 0;
    let timer;                              // to be stopped when last key is pressed */
    document.getElementsByTagName('body')[0].onkeydown = function(e) {
        // Start timer on first press
        if (first_press) {
            timer = setInterval(function() {
                seconds_counter += .1;
            }, 100);
        }
        first_press = false;

        // Evaluate each keystroke
        let ev = e;
        if(ev.key === 'Backspace') {
            char_els[curr_index - 1].className = "";  // delete both the current (underlined) and current -1 (y or n) key
            char_els[curr_index].className = "";
            curr_index--;
            char_els[curr_index].className = 'c';   // set next current char
            got_previous_char_correct = true;       // If you get the same key wrong twice, that's not what this let is meant to capture
        }
        else if(ev.key === unedited_string.charAt(curr_index)) {
            // Correct
            char_els[curr_index].className = 'y';
            curr_index ++;
            got_previous_char_correct = true;
            char_els[curr_index].className = 'c';   // set next current char
        }
        else if(ev.key !== 'Shift' && ev.key !== 'Meta') {
            console.log('\'' + ev.key + '\' != \'' + unedited_string.charAt(curr_index) + '\'');
            // Incorrect; previous was correct => move on
            if (got_previous_char_correct) {
                char_els[curr_index].className = 'n';
                curr_index++;
                char_els[curr_index].className = 'c';
            }
            // Incorrect; previous was also incorrect
            else {
                console.log('[Trailing 2 chars incorrect]');
            }
            got_previous_char_correct = false;
        }

        /*  --------- STORE PROGRESS ---------  */
        // Store progress on last keypress
        if (curr_index >= unedited_string.length-1) {
            if (typeof(Storage) !== "undefined") {
                let wpm = (unedited_string.length / 4.7) * 60 / seconds_counter; // there are 4.7 letters in the average word
                let rounded_wpm = Math.round(wpm * 10) /10;

                /* log progress */
                if(!localStorage.progress) {
                    let arr = [];
                    arr[0] = rounded_wpm;
                    localStorage.progress = JSON.stringify(arr);
                }
                else {
                    let progress = JSON.parse(localStorage.progress);
                    progress[progress.length] = rounded_wpm;
                    localStorage.progress = JSON.stringify(progress);
                }
            }
            clearInterval(timer);
            location.reload()
        }
    };
};